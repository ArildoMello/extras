HTML<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Escala GMs - Novembro 2025</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Arial,sans-serif}
    :root{
      --bg:#07051a;--text:#eaf1ff;--accent:#00e6ff;--purple:#7c4dff;
      --grad:linear-gradient(135deg,#00e6ff,#7c4dff);
      --card:rgba(20,25,60,.95);--border:rgba(100,150,255,.3);
      --menu-bg:rgba(10,15,45,.98);
    }
    body{background:var(--bg);color:var(--text);min-height:100vh;display:flex;position:relative;overflow-x:hidden}
    body::before{content:"";position:fixed;inset:0;background:radial-gradient(circle at 20% 80%,rgba(0,230,255,.12),transparent 50%);pointer-events:none;z-index:0}
    nav{width:80px;background:var(--menu-bg);backdrop-filter:blur(15px);border-right:1px solid var(--border);position:fixed;top:0;left:0;height:100vh;z-index:100;padding:25px 0;transition:width .4s cubic-bezier(0.25,0.8,0.25,1);overflow:hidden}
    nav:hover{width:280px}
    #menuBtn{display:none;position:fixed;top:18px;left:18px;z-index:101;background:var(--accent);color:#000;border:none;width:52px;height:52px;border-radius:50%;font-size:1.8rem;cursor:pointer;box-shadow:0 5px 20px rgba(0,230,255,.6)}
    .logo{text-align:center;margin:30px 0 50px;white-space:nowrap;overflow:hidden}
    .logo h1{font-size:2.4rem;font-weight:900;background:var(--grad);-webkit-background-clip:text;background-clip:text;color:transparent;opacity:0;transition:opacity .3s .2s}
    nav:hover .logo h1{opacity:1}
    .menu a{display:flex;align-items:center;gap:18px;padding:18px 20px;margin:8px 15px;border-radius:16px;color:var(--text);text-decoration:none;font-weight:600;font-size:1.1rem;transition:all .35s;position:relative;overflow:hidden;white-space:nowrap}
    .menu a i{font-size:1.8rem;min-width:40px;text-align:center;flex-shrink:0}
    .menu a span{opacity:0;transition:opacity .3s .1s}
    nav:hover .menu a span{opacity:1}
    .menu a::before{content:"";position:absolute;inset:0;background:var(--grad);opacity:0;transition:opacity .4s;z-index:-1}
    .menu a:hover{background:rgba(0,230,255,.25);box-shadow:0 8px 30px rgba(0,230,255,.4);transform:translateY(-4px);color:#fff}
    .menu a:hover::before{opacity:0.15}
    .menu a.active{background:var(--grad);color:#000;font-weight:900;box-shadow:0 10px 35px rgba(0,230,255,.6)}
    .menu a.active i{color:#000}
    main{flex:1;padding:30px;margin-left:80px;transition:margin-left .4s ease;position:relative;z-index:1;overflow-x:auto}
    nav:hover ~ main{margin-left:280px}
    h2{text-align:center;font-size:2.8rem;margin:25px 0 35px;background:var(--grad);-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:900}
    .filtro{text-align:center;margin:35px 0}
    input[type="text"]{padding:18px 32px;width:100%;max-width:720px;font-size:1.4rem;border-radius:18px;border:3px solid var(--accent);background:var(--bg);color:#fff;box-shadow:0 0 40px rgba(0,230,255,.5);outline:none;transition:all .3s}
    input[type="text"]:focus{box-shadow:0 0 70px rgba(0,230,255,.8);transform:scale(1.02);border-color:#7c4dff}
    table{width:100%;max-width:none;border-collapse:separate;border-spacing:0;background:var(--card);border-radius:20px;overflow:hidden;box-shadow:0 25px 80px rgba(0,0,0,.7)}
    th{background:var(--grad);color:#000;padding:18px 12px;font-weight:900;font-size:1rem;position:sticky;top:0;z-index:10;white-space:nowrap}
    td{padding:15px 10px;text-align:center;border-bottom:1px solid var(--border);font-size:1rem;white-space:nowrap}
    tr:hover td{background:rgba(0,230,255,.15)}
    .dia{font-weight:bold;background:rgba(47,123,255,.3);color:#c0e8ff;width:120px}
    .nome{color:var(--accent);font-weight:800;text-shadow:0 0 15px var(--accent)}
    .loading,.nenhum{text-align:center;padding:90px;font-size:2.1rem}
    .loading{color:var(--accent);text-shadow:0 0 20px var(--accent)}
    .nenhum{color:#ff6b6b}
    .total{text-align:center;margin:30px;color:var(--accent);font-size:1.6rem;font-weight:bold}
    .tab{display:none}
    .tab.active{display:block}
    @media(max-width:768px){
      #menuBtn{display:block}
      nav{width:280px;transform:translateX(-100%)}
      nav.open{transform:translateX(0)}
      main{margin-left:0 !important;padding:80px 20px 40px}
      .logo h1{opacity:1}
      .menu a span{opacity:1}
      th{font-size:0.85rem;padding:12px 6px}
      td{font-size:0.9rem;padding:12px 6px}
    }
  </style>
</head>
<body>
  <button id="menuBtn">Menu</button>
  <nav id="nav">
    <div class="logo"><h1>Escala GMs</h1></div>
    <div class="menu">
      <a href="#" class="active" data-tab="completa">Tabela <span>Escala Completa</span></a>
      <a href="#" data-tab="pesquisa">Lupa <span>Pesquisar por GM</span></a>
    </div>
  </nav>
  <main>
    <div id="completa" class="tab active">
      <h2>Escala Completa - Novembro 2025</h2>
      <div id="loading1" class="loading">Carregando escala completa...</div>
      <table id="tabelaCompleta" style="display:none">
        <thead id="cabecalhoCompleta"></thead>
        <tbody id="corpoCompleta"></tbody>
      </table>
    </div>
    <div id="pesquisa" class="tab">
      <h2>Pesquisar por GM</h2>
      <p style="text-align:center;color:#aabfff;margin-bottom:20px">Digite o nome do GM para ver todos os dias e locais</p>
      <div class="filtro">
        <input type="text" id="buscaGM" placeholder="Ex: RODRIGUES, BARBOSA, ALEX..." autofocus autocomplete="off">
      </div>
      <div id="loading2" class="loading">Carregando dados...</div>
      <div id="nenhum" class="nenhum" style="display:none">Nenhum resultado encontrado</div>
      <div id="resultados" style="display:none">
        <div class="total">Dias encontrados: <span id="contador">0</span></div>
        <table>
          <thead><tr><th>Dia</th><th>Data</th><th>GM</th><th>Posto / Horário</th></tr></thead>
          <tbody id="listaGM"></tbody>
        </table>
      </div>
    </div>
  </main>

  <script>
    // Menu mobile (igual)
    document.getElementById('menuBtn').addEventListener('click', function(e) {
      e.stopPropagation();
      const nav = document.getElementById('nav');
      nav.classList.toggle('open');
      this.textContent = nav.classList.contains('open') ? 'Close' : 'Menu';
    });
    document.addEventListener('click', function(e) {
      if (window.innerWidth <= 768 && document.getElementById('nav').classList.contains('open')) {
        const nav = document.getElementById('nav');
        const btn = document.getElementById('menuBtn');
        if (!nav.contains(e.target) && !btn.contains(e.target)) {
          nav.classList.remove('open');
          btn.textContent = 'Menu';
        }
      }
    });

    const CSV_URL = "https://docs.google.com/spreadsheets/d/1FpHBCrWWeS-Q0jq1ZH-NxYT1-fAtxq_YA_pbhaZwEYA/export?format=csv&gid=0";
    let dadosPlanilha = [], dadosGM = [];

    async function carregarTudo() {
      try {
        const r = await fetch("https://corsproxy.io/?" + encodeURIComponent(CSV_URL));
        const texto = await r.text();
        dadosPlanilha = Papa.parse(texto, {skipEmptyLines: true}).data;

        // === CABEÇALHO (igual ao seu funcionando) ===
        const linhaCabecalho = dadosPlanilha[1] || [];
        const postos = linhaCabecalho.slice(2);
        let htmlCab = "<tr><th>Dia</th><th>Data</th>";
        postos.forEach((posto, index) => {
          let nomePosto = (posto || '').trim();
          if (!nomePosto) nomePosto = `Posto ${index + 1}`;
          else nomePosto = nomePosto.replace(/^E\d+\s*-?\s*/i, '').trim();
          htmlCab += `<th title="Posto ${index + 1}">${nomePosto}</th>`;
        });
        htmlCab += "</tr>";
        document.getElementById("cabecalhoCompleta").innerHTML = htmlCab;

        // === CORPO DA TABELA (igual) ===
        const corpo = document.getElementById("corpoCompleta");
        corpo.innerHTML = "";
        for (let i = 3; i < dadosPlanilha.length; i++) {
          const linha = dadosPlanilha[i];
          if (!linha[0] || !linha[1]) continue;
          const tr = document.createElement("tr");
          const nomesNaLinha = (linha.slice(2) || []).filter(n => n && n.trim()).map(n => n.trim().toUpperCase()).join(" ");
          tr.dataset.nomes = nomesNaLinha;
          let html = `<td class="dia">${linha[0].trim()}</td><td class="dia">${linha[1].trim()}</td>`;
          for (let j = 2; j < linha.length; j++) {
            const nome = (linha[j] || '').trim();
            html += `<td class="${nome ? 'nome' : ''}">${nome || '-'}</td>`;
          }
          tr.innerHTML = html;
          corpo.appendChild(tr);
        }
        document.getElementById("loading1").style.display = "none";
        document.getElementById("tabelaCompleta").style.display = "table";

        // === PREPARA BUSCA (igual) ===
        dadosGM = [];
        for (let i = 3; i < dadosPlanilha.length; i++) {
          const linha = dadosPlanilha[i];
          if (!linha[0]) continue;
          const dia = linha[0].trim();
          const data = linha[1].trim();
          for (let c = 2; c < linha.length; c++) {
            const gm = (linha[c] || '').trim();
            if (gm) {
              const postoOriginal = (dadosPlanilha[1][c] || '').trim();
              let postoLimpo = postoOriginal.replace(/^E\d+\s*-?\s*/i, '').trim() || `Posto ${c - 1}`;
              dadosGM.push({dia, data, gm: gm.toUpperCase(), local: postoLimpo});
            }
          }
        }
        document.getElementById("loading2").style.display = "none";

      } catch (e) {
        document.getElementById("loading1").innerHTML = "Erro ao carregar. Tente recarregar a página.";
        console.error(e);
      }
    }

    // Navegação (igual)
    document.querySelectorAll(".menu a").forEach(link => {
      link.addEventListener("click", function(e) {
        e.preventDefault();
        document.querySelectorAll(".menu a").forEach(a => a.classList.remove("active"));
        this.classList.add("active");
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        document.getElementById(this.dataset.tab).classList.add("active");
        if (this.dataset.tab === "pesquisa") setTimeout(() => document.getElementById("buscaGM").focus(), 100);
      });
    });

    // AQUI ESTÁ A ÚNICA MUDANÇA: ORDENAÇÃO CORRETA POR DATA
    document.getElementById("buscaGM").addEventListener("input", function() {
      const termo = this.value.toUpperCase().trim();
      const lista = document.getElementById("listaGM");
      const res = document.getElementById("resultados");
      const nenhum = document.getElementById("nenhum");

      if (!termo) {
        res.style.display = "none";
        nenhum.style.display = "none";
        return;
      }

      const filtrados = dadosGM
        .filter(x => x.gm.includes(termo))
        .sort((a, b) => {
          const diaA = parseInt(a.data.split("/")[0], 10);
          const diaB = parseInt(b.data.split("/")[0], 10);
          return diaA - diaB; // Ordem cronológica correta: 1, 2, 3... 30
        });

      if (filtrados.length === 0) {
        res.style.display = "none";
        nenhum.style.display = "block";
        return;
      }

      lista.innerHTML = "";
      filtrados.forEach(d => {
        lista.innerHTML += `<tr>
          <td class="dia">${d.dia}</td>
          <td class="dia">${d.data}</td>
          <td class="nome">${d.gm}</td>
          <td style="white-space: normal;">${d.local}</td>
        </tr>`;
      });

      document.getElementById("contador").textContent = filtrados.length;
      nenhum.style.display = "none";
      res.style.display = "block";
    });

    carregarTudo();
  </script>
</body>
</html>
